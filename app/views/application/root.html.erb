<%= render partial: 'application/navbar', locals: {reports: @collection.reports} %>

<div class="container">
  <div class="row">
    <div class="col-xs-4">
      <%= @collection.reports.length %> different species of birds have been
      spotted near your location in the past 30 days. Click through the list
      of birds below to load recent observations logged in the eBird database!
      <ul class="list-group">
      <% @collection.reports.each do |report| %>
        <li class="select_species list-group-item" data-species="<%= report.sci_name %>"><a> <%= report.com_name %></a> </li>
      <% end %>
      </ul>
    </div>

    <div class="col-xs-8">
      <div id="map-outer">
        <div id="map"></div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
function initMap() {
// var myLatlng = new google.maps.LatLng(<%= @centroid[0].to_s %> , <%= @centroid[1].to_s %>);
var myLatlng = new google.maps.LatLng(<%= @lat %> , <%= @lng %>);

var mapOptions = {
     zoom: 10,
    center: myLatlng
};

markers = [];

map = new google.maps.Map(document.getElementById("map"), mapOptions);
<% @collection.search_species.each do |report| %>
var myLatlng = new google.maps.LatLng(<%= report.lat %>,<%= report.lng %>);

var marker = new google.maps.Marker({
    position: myLatlng,
    // title: "Observed on date"+<%= report.obs_dt.to_s || " " %>
    title: "<%= report.com_name %> (Observed on <%= report.obs_dt %>)"
});

marker.setMap(map);
markers.push(marker);
<% end %>

// run after init
// debugger;

}
</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=<%= ENV["gmaps_api_key"] %>&v=3&sensor=false&callback=initMap">
</script>
